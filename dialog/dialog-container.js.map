{"version":3,"file":"dialog-container.js","sourceRoot":"","sources":["../../../../src/lib/dialog/dialog-container.ts"],"names":[],"mappings":";;;;;;;;;;;;;;OAAO,EACL,SAAS,EAET,SAAS,EACT,iBAAiB,EACjB,MAAM,EAEN,QAAQ,EACT,MAAM,eAAe;OACf,EAAC,cAAc,EAAmB,mBAAmB,EAAiB,MAAM,SAAS;OAGrF,EAAC,mCAAmC,EAAC,MAAM,iBAAiB;OAC5D,EAAC,SAAS,EAAC,MAAM,yBAAyB;OAC1C,yBAAyB;AAGhC;;;GAGG;AAYH;IAAuC,qCAAc;IAgBnD,2BAAoB,OAAe,EAAU,SAAmB;QAC9D,iBAAO,CAAC;QADU,YAAO,GAAP,OAAO,CAAQ;QAAU,cAAS,GAAT,SAAS,CAAU;QAThE,8FAA8F;QACtF,yCAAoC,GAAY,IAAI,CAAC;IAU7D,CAAC;IAED;;;OAGG;IACH,iDAAqB,GAArB,UAAyB,MAA0B;QACjD,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;YACnC,MAAM,IAAI,mCAAmC,EAAE,CAAC;QAClD,CAAC;QAED,IAAI,YAAY,GAAG,IAAI,CAAC,WAAW,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC;QAClE,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,MAAM,CAAC,YAAY,CAAC;IACtB,CAAC;IAED;;;OAGG;IACH,gDAAoB,GAApB,UAAqB,MAAsB;QACzC,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;YACnC,MAAM,IAAI,mCAAmC,EAAE,CAAC;QAClD,CAAC;QAED,IAAI,cAAc,GAAG,IAAI,CAAC,WAAW,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC;QACnE,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,MAAM,CAAC,cAAc,CAAC;IACxB,CAAC;IAED;;;OAGG;IACK,sCAAU,GAAlB;QAAA,iBAQC;QAPC,2FAA2F;QAC3F,2FAA2F;QAC3F,4CAA4C;QAC5C,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,KAAK,EAAE,CAAC,SAAS,CAAC;YAC9C,KAAI,CAAC,oCAAoC,GAAG,QAAQ,CAAC,aAAa,CAAC;YACnE,KAAI,CAAC,UAAU,CAAC,yBAAyB,EAAE,CAAC;QAC9C,CAAC,CAAC,CAAC;IACL,CAAC;IAED,uCAAW,GAAX;QAAA,iBAUC;QATC,0FAA0F;QAC1F,0FAA0F;QAC1F,6FAA6F;QAC7F,wDAAwD;QACxD,EAAE,CAAC,CAAC,IAAI,CAAC,oCAAoC,CAAC,CAAC,CAAC;YAC9C,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,KAAK,EAAE,CAAC,SAAS,CAAC;gBAC9C,KAAI,CAAC,SAAS,CAAC,mBAAmB,CAAC,KAAI,CAAC,oCAAoC,EAAE,OAAO,CAAC,CAAC;YACzF,CAAC,CAAC,CAAC;QACL,CAAC;IACH,CAAC;IAtED;QAAC,SAAS,CAAC,mBAAmB,CAAC;;0DAAA;IAG/B;QAAC,SAAS,CAAC,SAAS,CAAC;;yDAAA;IAhBvB;QAAC,SAAS,CAAC;YACT,QAAQ,EAAE,MAAM,CAAC,EAAE;YACnB,QAAQ,EAAE,2CAA2C;YACrD,WAAW,EAAE,uBAAuB;YACpC,SAAS,EAAE,CAAC,YAAY,CAAC;YACzB,IAAI,EAAE;gBACJ,8BAA8B,EAAE,MAAM;gBACtC,aAAa,EAAE,oBAAoB;aACpC;YACD,aAAa,EAAE,iBAAiB,CAAC,IAAI;SACtC,CAAC;;yBAAA;IA0EF,wBAAC;AAAD,CAAC,AAzED,CAAuC,cAAc,GAyEpD","sourcesContent":["import {\r\n  Component,\r\n  ComponentRef,\r\n  ViewChild,\r\n  ViewEncapsulation,\r\n  NgZone,\r\n  OnDestroy,\r\n  Renderer,\r\n} from '@angular/core';\r\nimport {BasePortalHost, ComponentPortal, PortalHostDirective, TemplatePortal} from '../core';\r\nimport {MdDialogConfig} from './dialog-config';\r\nimport {MdDialogRef} from './dialog-ref';\r\nimport {MdDialogContentAlreadyAttachedError} from './dialog-errors';\r\nimport {FocusTrap} from '../core/a11y/focus-trap';\r\nimport 'rxjs/add/operator/first';\r\n\r\n\r\n/**\r\n * Internal component that wraps user-provided dialog content.\r\n * @docs-private\r\n */\r\n@Component({\r\n  moduleId: module.id,\r\n  selector: 'md-dialog-container, mat-dialog-container',\r\n  templateUrl: 'dialog-container.html',\r\n  styleUrls: ['dialog.css'],\r\n  host: {\r\n    '[class.mat-dialog-container]': 'true',\r\n    '[attr.role]': 'dialogConfig?.role',\r\n  },\r\n  encapsulation: ViewEncapsulation.None,\r\n})\r\nexport class MdDialogContainer extends BasePortalHost implements OnDestroy {\r\n  /** The portal host inside of this container into which the dialog content will be loaded. */\r\n  @ViewChild(PortalHostDirective) _portalHost: PortalHostDirective;\r\n\r\n  /** The directive that traps and manages focus within the dialog. */\r\n  @ViewChild(FocusTrap) _focusTrap: FocusTrap;\r\n\r\n  /** Element that was focused before the dialog was opened. Save this to restore upon close. */\r\n  private _elementFocusedBeforeDialogWasOpened: Element = null;\r\n\r\n  /** The dialog configuration. */\r\n  dialogConfig: MdDialogConfig;\r\n\r\n  /** Reference to the open dialog. */\r\n  dialogRef: MdDialogRef<any>;\r\n\r\n  constructor(private _ngZone: NgZone, private _renderer: Renderer) {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Attach a ComponentPortal as content to this dialog container.\r\n   * @param portal Portal to be attached as the dialog content.\r\n   */\r\n  attachComponentPortal<T>(portal: ComponentPortal<T>): ComponentRef<T> {\r\n    if (this._portalHost.hasAttached()) {\r\n      throw new MdDialogContentAlreadyAttachedError();\r\n    }\r\n\r\n    let attachResult = this._portalHost.attachComponentPortal(portal);\r\n    this._trapFocus();\r\n    return attachResult;\r\n  }\r\n\r\n  /**\r\n   * Attach a TemplatePortal as content to this dialog container.\r\n   * @param portal Portal to be attached as the dialog content.\r\n   */\r\n  attachTemplatePortal(portal: TemplatePortal): Map<string, any> {\r\n    if (this._portalHost.hasAttached()) {\r\n      throw new MdDialogContentAlreadyAttachedError();\r\n    }\r\n\r\n    let attachedResult = this._portalHost.attachTemplatePortal(portal);\r\n    this._trapFocus();\r\n    return attachedResult;\r\n  }\r\n\r\n  /**\r\n   * Moves the focus inside the focus trap.\r\n   * @private\r\n   */\r\n  private _trapFocus() {\r\n    // If were to attempt to focus immediately, then the content of the dialog would not yet be\r\n    // ready in instances where change detection has to run first. To deal with this, we simply\r\n    // wait for the microtask queue to be empty.\r\n    this._ngZone.onMicrotaskEmpty.first().subscribe(() => {\r\n      this._elementFocusedBeforeDialogWasOpened = document.activeElement;\r\n      this._focusTrap.focusFirstTabbableElement();\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    // When the dialog is destroyed, return focus to the element that originally had it before\r\n    // the dialog was opened. Wait for the DOM to finish settling before changing the focus so\r\n    // that it doesn't end up back on the <body>. Also note that we need the extra check, because\r\n    // IE can set the `activeElement` to null in some cases.\r\n    if (this._elementFocusedBeforeDialogWasOpened) {\r\n      this._ngZone.onMicrotaskEmpty.first().subscribe(() => {\r\n        this._renderer.invokeElementMethod(this._elementFocusedBeforeDialogWasOpened, 'focus');\r\n      });\r\n    }\r\n  }\r\n}\r\n"]}